services:
  swipy-django:
    image: "${WEB_IMAGE}"
    volumes:
      - ./db.sqlite3:/code/db.sqlite3
      - ./staticfiles:/code/staticfiles
    ports:
      - "8000:8000"
    env_file:
      - .env

  swipy-django-migration:
    image: "${WEB_IMAGE}"
    env_file:
      - .env
    command: python manage.py collectstatic --noinput && python manage.py migrate --noinput
    volumes:
      - ./db.sqlite3:/code/db.sqlite3
      - ./staticfiles:/code/staticfiles

  swipy-nginx:
    image: nginx:1.22.1
    ports:
      # TODO oleksandr: do I need 0.0.0.0 here ?
      - "0.0.0.0:443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf
      - ./swipy_link-chain.crt:/swipy/swipy_link-chain.crt
      - ./swipy_link.key:/swipy/swipy_link.key
    depends_on:
      - swipy-django
